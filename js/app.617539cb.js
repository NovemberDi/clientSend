(function(){"use strict";var e={9173:function(e,n,t){var a=t(9242),l=t(3396);const s={class:"wrapper__page"},i=(0,l._)("div",{class:"adv"},null,-1);function o(e,n,t,a,o,r){const c=(0,l.up)("main-page");return(0,l.wg)(),(0,l.iD)("div",s,[(0,l.Wm)(c),i])}const r=e=>((0,l.dD)("data-v-6495bc0a"),e=e(),(0,l.Cn)(),e),c={class:"page"},d=(0,l.uE)('<div class="header" data-v-6495bc0a><div class="top" data-v-6495bc0a><div class="name" data-v-6495bc0a><p data-v-6495bc0a>Передайфайл</p></div><div class="logo" data-v-6495bc0a><p data-v-6495bc0a>Лого</p></div></div><div class="bottom" data-v-6495bc0a><h2 data-v-6495bc0a>Сервис удобного обмена файлами</h2></div></div>',1),u=r((()=>(0,l._)("div",{class:"footer"},null,-1)));function p(e,n,t,a,s,i){const o=(0,l.up)("main-block");return(0,l.wg)(),(0,l.iD)("div",c,[d,(0,l.Wm)(o),u])}var v=t(7139);const f=e=>((0,l.dD)("data-v-7d29c279"),e=e(),(0,l.Cn)(),e),m={class:"main"},w=f((()=>(0,l._)("div",{class:"shadow_box"},null,-1))),_={class:"main__content"},b={class:"connection__id"};function g(e,n,t,s,i,o){const r=(0,l.up)("send-view"),c=(0,l.up)("receive-view"),d=(0,l.up)("connection-view");return(0,l.wg)(),(0,l.iD)("div",m,[(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,v.C_)(["stik stik__one",{active__one:i.selectMode,disactive__one:!i.selectMode}]),onClick:n[0]||(n[0]=e=>i.selectMode=!i.selectMode)},"Передать",2),(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,v.C_)(["stik stik__two",{active__two:!i.selectMode,disactive__two:i.selectMode}]),onClick:n[1]||(n[1]=e=>i.selectMode=!i.selectMode)},"Получить",2),w,(0,l._)("div",_,[(0,l.wy)((0,l.Wm)(r,{class:(0,v.C_)({mute:!s.dataChannel}),percentOfSend:s.percentOfSend,onOnClickSend:n[2]||(n[2]=e=>s.sendFile(e,this.dataChannel))},null,8,["class","percentOfSend"]),[[a.F8,i.selectMode]]),(0,l.wy)((0,l.Wm)(c,{webrctMessage:s.webrctMessage,fileName:s.fileName},null,8,["webrctMessage","fileName"]),[[a.F8,!i.selectMode]])]),(0,l._)("div",b,[(0,l.Wm)(d,{id:s.id,linkStatus:s.linkStatus,onSendId:s.sendId,modelValue:s.inputValue,"onUpdate:modelValue":n[3]||(n[3]=e=>s.inputValue=e)},null,8,["id","linkStatus","onSendId","modelValue"])])])}const h=e=>((0,l.dD)("data-v-097f7f30"),e=e(),(0,l.Cn)(),e),y={class:"send__wrap"},S={class:"send_mess"},M={class:"input-file"},O=h((()=>(0,l._)("span",{class:"input-file-btn"},"Выберите файл",-1))),C={class:"input-file-text",type:"text"},k={class:"send"},I={class:"percent"};function V(e,n,t,a,s,i){return(0,l.wg)(),(0,l.iD)("div",y,[(0,l._)("div",S,[(0,l._)("label",M,[O,(0,l._)("span",C,(0,v.zw)(s.nameFile),1),(0,l._)("input",{class:"input",type:"file",onChange:n[0]||(n[0]=(...e)=>i.onChangeInput&&i.onChangeInput(...e))},null,32)]),(0,l._)("div",k,[(0,l._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>i.sendFile&&i.sendFile(...e))}," Отправить")])]),(0,l._)("div",{class:"progress",style:(0,v.j5)(`background: linear-gradient(90deg, rgb(0, 136, 255) ${t.percentOfSend}%, rgb(215, 215, 215) ${t.percentOfSend}%)`)},null,4),(0,l._)("div",I,(0,v.zw)(t.percentOfSend)+"% ",1)])}var N={name:"SendView",data(){return{inputValue:null,nameFile:null}},props:{percentOfSend:""},methods:{sendFile(){this.inputValue&&this.$emit("onClickSend",this.inputValue)},onChangeInput(e){this.inputValue=e,this.nameFile=this.inputValue?this.inputValue.target.files[0].name:null}}},D=t(89);const F=(0,D.Z)(N,[["render",V],["__scopeId","data-v-097f7f30"]]);var R=F;const J=e=>((0,l.dD)("data-v-64c8858a"),e=e(),(0,l.Cn)(),e),T={class:"message"},j=J((()=>(0,l._)("div",null,"Ваш файл: ",-1))),x={class:"href"},H=["href","download"];function z(e,n,t,a,s,i){return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",T,[j,(0,l._)("div",x,[(0,l._)("a",{href:`${t.webrctMessage}`,download:`${t.fileName}`},(0,v.zw)(t.fileName),9,H)])])])}var A={name:"ReceiveView",props:{fileName:"",webrctMessage:""}};const $=(0,D.Z)(A,[["render",z],["__scopeId","data-v-64c8858a"]]);var W=$;const Z=e=>((0,l.dD)("data-v-58f7c633"),e=e(),(0,l.Cn)(),e),L={class:"id__wrap"},P={class:"id"},B=Z((()=>(0,l._)("div",{class:"qr"},null,-1))),K={class:"send_id"},U=["value"];function Y(e,n,t,a,s,i){return(0,l.wg)(),(0,l.iD)("div",L,[(0,l._)("div",P," Мой ID: "+(0,v.zw)(t.id),1),(0,l._)("div",null,[(0,l._)("p",null," Состояние: "+(0,v.zw)(t.linkStatus),1)]),B,(0,l._)("div",K,[(0,l._)("input",{class:"input-id",type:"text",value:t.modelValue,placeholder:"Введите ID партнёра",onInput:n[0]||(n[0]=(...e)=>i.updateInput&&i.updateInput(...e))},null,40,U),(0,l._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>i.sendId&&i.sendId(...e))}," Вступить")])])}var E={name:"ConnectionView",props:{id:{type:String},linkStatus:{type:String},modelValue:[String,Number]},methods:{sendId(){this.$emit("sendId")},updateInput(e){this.$emit("update:modelValue",e.target.value)}}};const q=(0,D.Z)(E,[["render",Y],["__scopeId","data-v-58f7c633"]]);var G=q,Q=t(4870);function X(){let e=(0,Q.iH)("0"),n=null,t=(t,a)=>{n=t.target.files[0],console.log(n.name,n.size,n.type);let l=n.size,s=262144,i=0,o=new FileReader,r=()=>{let t=n.slice(i,i+s);i+=s,e.value=Math.floor(100*(i/l>1?1:i/l))+"",console.log(e),o.readAsArrayBuffer(t)};o.onload=()=>{a&&(a.send(o.result),a.bufferedAmount>a.bufferedAmountLowThreshold?a.onbufferedamountlow=()=>{a.onbufferedamountlow=null,i<l?r():(a.send(JSON.stringify({type:"end",name:n.name})),n=null)}:i<l?r():(a.send(JSON.stringify({type:"end",name:n.name})),n=null,alert("Отправлено!")))},o.onerror=function(){console.log(o.error)},r()};return{percentOfSend:e,sendFile:t}}t(7658);function ee(){let e=[],n=(0,Q.iH)(),t=(0,Q.iH)(),a=a=>{if("string"==typeof a.data){const l=new Blob(e);t.value=URL.createObjectURL(l),n.value=JSON.parse(a.data).name,e=[]}else e.push(a.data)};return{fileName:n,webrctMessage:t,onMesRTC:a}}function ne(e){let n,t=(0,Q.iH)("ожидание.."),a=(0,Q.iH)("ожидание"),s=(0,Q.iH)(""),i=(0,Q.iH)(),o=(0,Q.iH)(),r=null,c=!1,d="",u="",p=()=>{r=new WebSocket("wss://wsserver.dimkayaa.repl.co"),r.onmessage=e=>{let l=JSON.parse(e.data);console.log("сообщение от сервера!"),"id"==l.type&&(t.value=l.value),"link"==l.type&&(a.value=l.value,c&&_()),"newOffer"==l.type&&(d=l.value,b(l.value)),"newAnswer"==l.type&&(u=l.value,n.setRemoteDescription(JSON.parse(u))),"candidate"==l.type&&(console.log("Новый кандидат",l.value),w(l.value))}},v=(e,n)=>{let t={type:e,value:n};r.send(JSON.stringify(t))},f=()=>{v("id",s.value),s.value=null,c=!0},m=async()=>{n=new RTCPeerConnection({iceServers:[{urls:"stun:relay.metered.ca:80"},{urls:"turn:relay.metered.ca:80",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"},{urls:"turn:relay.metered.ca:443",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"},{urls:"turn:relay.metered.ca:443?transport=tcp",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"}]}),n.onicecandidate=e=>{const n={type:"candidate",value:null};n.value=e.candidate,v(n.type,n.value)}},w=async e=>{n||await m(),await n.addIceCandidate(e),console.log("Кандидат добавлен")},_=async()=>{await m(),i.value=n.createDataChannel("test"),i.value.onopen=()=>a.value="Готов к передаче!",i.value.onclose=()=>g(),i.value.onmessage=n=>e(n);let t=await n.createOffer();console.log(t),v("offer",JSON.stringify(t)),await n.setLocalDescription(t)},b=async()=>{n||await m();let t=JSON.parse(d);console.log(t),n.setRemoteDescription(t),n.ondatachannel=n=>{i.value=n.channel,i.value.onopen=()=>a.value="Готов к передаче!",i.value.onclose=()=>g(),i.value.onmessage=n=>e(n)};let l=await n.createAnswer();v("answer",JSON.stringify(l)),await n.setLocalDescription(l)};function g(){n=null,i.value=null,d="",u="",c=!1,a.value="ожидание"}return(0,l.bv)(p),{sendMessage:v,sendId:f,id:t,linkStatus:a,inputValue:s,webrctStatus:o,dataChannel:i}}var te={name:"MainBlock",components:{SendView:R,ReceiveView:W,ConnectionView:G},data(){return{selectMode:!0}},setup(){const{percentOfSend:e,sendFile:n}=X(),{fileName:t,webrctMessage:a,onMesRTC:l}=ee(),{sendId:s,id:i,inputValue:o,linkStatus:r,webrctStatus:c,dataChannel:d}=ne(l);return{sendFile:n,percentOfSend:e,fileName:t,webrctMessage:a,id:i,sendId:s,inputValue:o,linkStatus:r,webrctStatus:c,dataChannel:d}},methods:{},mounted(){}};const ae=(0,D.Z)(te,[["render",g],["__scopeId","data-v-7d29c279"]]);var le=ae,se={name:"MainPage",components:{MainBlock:le},props:{}};const ie=(0,D.Z)(se,[["render",p],["__scopeId","data-v-6495bc0a"]]);var oe=ie,re={name:"App",components:{MainPage:oe}};const ce=(0,D.Z)(re,[["render",o]]);var de=ce;(0,a.ri)(de).mount("#app")}},n={};function t(a){var l=n[a];if(void 0!==l)return l.exports;var s=n[a]={exports:{}};return e[a](s,s.exports,t),s.exports}t.m=e,function(){var e=[];t.O=function(n,a,l,s){if(!a){var i=1/0;for(d=0;d<e.length;d++){a=e[d][0],l=e[d][1],s=e[d][2];for(var o=!0,r=0;r<a.length;r++)(!1&s||i>=s)&&Object.keys(t.O).every((function(e){return t.O[e](a[r])}))?a.splice(r--,1):(o=!1,s<i&&(i=s));if(o){e.splice(d--,1);var c=l();void 0!==c&&(n=c)}}return n}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,l,s]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};t.O.j=function(n){return 0===e[n]};var n=function(n,a){var l,s,i=a[0],o=a[1],r=a[2],c=0;if(i.some((function(n){return 0!==e[n]}))){for(l in o)t.o(o,l)&&(t.m[l]=o[l]);if(r)var d=r(t)}for(n&&n(a);c<i.length;c++)s=i[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(d)},a=self["webpackChunkclient"]=self["webpackChunkclient"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=t.O(void 0,[998],(function(){return t(9173)}));a=t.O(a)})();
//# sourceMappingURL=app.617539cb.js.map