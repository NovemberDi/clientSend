(function(){"use strict";var e={6525:function(e,n,t){var a=t(9242),s=t(3396);const l={class:"wrapper__page"},i=(0,s._)("div",{class:"adv"},null,-1);function r(e,n,t,a,r,o){const c=(0,s.up)("main-page");return(0,s.wg)(),(0,s.iD)("div",l,[(0,s.Wm)(c),i])}const o=e=>((0,s.dD)("data-v-6495bc0a"),e=e(),(0,s.Cn)(),e),c={class:"page"},d=(0,s.uE)('<div class="header" data-v-6495bc0a><div class="top" data-v-6495bc0a><div class="name" data-v-6495bc0a><p data-v-6495bc0a>Передайфайл</p></div><div class="logo" data-v-6495bc0a><p data-v-6495bc0a>Лого</p></div></div><div class="bottom" data-v-6495bc0a><h2 data-v-6495bc0a>Сервис удобного обмена файлами</h2></div></div>',1),u=o((()=>(0,s._)("div",{class:"footer"},null,-1)));function p(e,n,t,a,l,i){const r=(0,s.up)("main-block");return(0,s.wg)(),(0,s.iD)("div",c,[d,(0,s.Wm)(r),u])}var v=t(7139);const f=e=>((0,s.dD)("data-v-023de63a"),e=e(),(0,s.Cn)(),e),m={class:"main"},w=f((()=>(0,s._)("div",{class:"shadow_box"},null,-1))),b={class:"main__content"},g={class:"connection__id"};function _(e,n,t,l,i,r){const o=(0,s.up)("send-view"),c=(0,s.up)("receive-view"),d=(0,s.up)("connection-view");return(0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,v.C_)(["stik stik__one",{active__one:i.selectMode,disactive__one:!i.selectMode}]),onClick:n[0]||(n[0]=e=>i.selectMode=!i.selectMode)},"Передать",2),(0,s._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,v.C_)(["stik stik__two",{active__two:!i.selectMode,disactive__two:i.selectMode}]),onClick:n[1]||(n[1]=e=>i.selectMode=!i.selectMode)},"Получить",2),w,(0,s._)("div",b,[(0,s.wy)((0,s.Wm)(o,{class:(0,v.C_)({mute:!l.dataChannel}),percentOfSend:l.percentOfSend,onOnClickSend:n[2]||(n[2]=e=>l.sendFile(e,this.dataChannel))},null,8,["class","percentOfSend"]),[[a.F8,i.selectMode]]),(0,s.wy)((0,s.Wm)(c,{webrctMessage:l.webrctMessage,fileName:l.fileName},null,8,["webrctMessage","fileName"]),[[a.F8,!i.selectMode]])]),(0,s._)("div",g,[(0,s.Wm)(d,{id:l.id,linkStatus:l.linkStatus,webrctStatus:l.webrctStatus,onSendId:l.sendId,modelValue:l.inputValue,"onUpdate:modelValue":n[3]||(n[3]=e=>l.inputValue=e)},null,8,["id","linkStatus","webrctStatus","onSendId","modelValue"])])])}const h=e=>((0,s.dD)("data-v-097f7f30"),e=e(),(0,s.Cn)(),e),y={class:"send__wrap"},S={class:"send_mess"},M={class:"input-file"},O=h((()=>(0,s._)("span",{class:"input-file-btn"},"Выберите файл",-1))),C={class:"input-file-text",type:"text"},k={class:"send"},I={class:"percent"};function V(e,n,t,a,l,i){return(0,s.wg)(),(0,s.iD)("div",y,[(0,s._)("div",S,[(0,s._)("label",M,[O,(0,s._)("span",C,(0,v.zw)(l.nameFile),1),(0,s._)("input",{class:"input",type:"file",onChange:n[0]||(n[0]=(...e)=>i.onChangeInput&&i.onChangeInput(...e))},null,32)]),(0,s._)("div",k,[(0,s._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>i.sendFile&&i.sendFile(...e))}," Отправить")])]),(0,s._)("div",{class:"progress",style:(0,v.j5)(`background: linear-gradient(90deg, rgb(0, 136, 255) ${t.percentOfSend}%, rgb(215, 215, 215) ${t.percentOfSend}%)`)},null,4),(0,s._)("div",I,(0,v.zw)(t.percentOfSend)+"% ",1)])}var N={name:"SendView",data(){return{inputValue:null,nameFile:null}},props:{percentOfSend:""},methods:{sendFile(){this.inputValue&&this.$emit("onClickSend",this.inputValue)},onChangeInput(e){this.inputValue=e,this.nameFile=this.inputValue?this.inputValue.target.files[0].name:null}}},D=t(89);const F=(0,D.Z)(N,[["render",V],["__scopeId","data-v-097f7f30"]]);var R=F;const J={class:"message"},T=["href","download"];function j(e,n,t,a,l,i){return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",J,[(0,s._)("div",null,[(0,s.Uk)("Ваш файл: "),(0,s._)("a",{href:`${t.webrctMessage}`,download:`${t.fileName}`},(0,v.zw)(t.fileName),9,T)])])])}var x={name:"ReceiveView",props:{fileName:"",webrctMessage:""}};const z=(0,D.Z)(x,[["render",j]]);var H=z;const A=e=>((0,s.dD)("data-v-3810f46e"),e=e(),(0,s.Cn)(),e),$={class:"id__wrap"},W={class:"id"},Z=A((()=>(0,s._)("div",{class:"qr"},null,-1))),L={class:"send_id"},P=["value"];function B(e,n,t,a,l,i){return(0,s.wg)(),(0,s.iD)("div",$,[(0,s._)("div",W," Мой ID: "+(0,v.zw)(t.id),1),(0,s._)("div",null,[(0,s._)("p",null," Состояние: "+(0,v.zw)(t.linkStatus)+" "+(0,v.zw)(t.webrctStatus),1)]),Z,(0,s._)("div",L,[(0,s._)("input",{class:"input-id",type:"text",value:t.modelValue,placeholder:"Введите ID партнёра",onInput:n[0]||(n[0]=(...e)=>i.updateInput&&i.updateInput(...e))},null,40,P),(0,s._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>i.sendId&&i.sendId(...e))}," Вступить")])])}var U={name:"ConnectionView",props:{id:{type:String},linkStatus:{type:String},webrctStatus:{type:String},modelValue:[String,Number]},methods:{sendId(){this.$emit("sendId")},updateInput(e){this.$emit("update:modelValue",e.target.value)}}};const K=(0,D.Z)(U,[["render",B],["__scopeId","data-v-3810f46e"]]);var Y=K,E=t(4870);function q(){let e=(0,E.iH)("0"),n=null,t=(t,a)=>{n=t.target.files[0],console.log(n.name,n.size,n.type);let s=n.size,l=262144,i=0,r=new FileReader,o=()=>{let t=n.slice(i,i+l);i+=l,e.value=Math.floor(i/s*100)+"",console.log(e),r.readAsArrayBuffer(t)};r.onload=()=>{a&&(a.send(r.result),a.bufferedAmount>a.bufferedAmountLowThreshold?a.onbufferedamountlow=()=>{a.onbufferedamountlow=null,i<s?o():(a.send(JSON.stringify({type:"end",name:n.name})),n=null)}:i<s?o():(a.send(JSON.stringify({type:"end",name:n.name})),n=null,alert("Отправлено!")))},r.onerror=function(){console.log(r.error)},o()};return{percentOfSend:e,sendFile:t}}t(7658);function G(){let e=[],n=(0,E.iH)(),t=(0,E.iH)(),a=a=>{if("string"==typeof a.data){const s=new Blob(e);t.value=URL.createObjectURL(s),n.value=JSON.parse(a.data).name,e=[]}else e.push(a.data)};return{fileName:n,webrctMessage:t,onMesRTC:a}}function Q(e){let n,t=(0,E.iH)("ожидание.."),a=(0,E.iH)("ожидание"),l=(0,E.iH)(""),i=(0,E.iH)(),r=(0,E.iH)(),o=null,c=!1,d="",u="",p=()=>{o=new WebSocket("wss://wsserver.dimkayaa.repl.co"),o.onmessage=e=>{let s=JSON.parse(e.data);console.log("сообщение от сервера!"),"id"==s.type&&(t.value=s.value),"link"==s.type&&(a.value=s.value,c&&b()),"newOffer"==s.type&&(d=s.value,g(s.value)),"newAnswer"==s.type&&(u=s.value,n.setRemoteDescription(JSON.parse(u))),"candidate"==s.type&&(console.log("Новый кандидат",s.value),w(s.value))}},v=(e,n)=>{let t={type:e,value:n};o.send(JSON.stringify(t))},f=()=>{v("id",l.value),l.value=null,c=!0},m=async()=>{n=new RTCPeerConnection({iceServers:[{urls:"stun:relay.metered.ca:80"},{urls:"turn:relay.metered.ca:80",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"},{urls:"turn:relay.metered.ca:443",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"},{urls:"turn:relay.metered.ca:443?transport=tcp",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"}]}),n.onicecandidate=e=>{const n={type:"candidate",value:null};n.value=e.candidate,v(n.type,n.value)}},w=async e=>{n||await m(),await n.addIceCandidate(e),console.log("Кандидат добавлен")},b=async()=>{await m(),i.value=n.createDataChannel("test"),i.value.onopen=()=>a.value="Готов к передаче!",i.value.onmessage=n=>e(n);let t=await n.createOffer();console.log(t),v("offer",JSON.stringify(t)),await n.setLocalDescription(t)},g=async()=>{n||await m();let t=JSON.parse(d);console.log(t),n.setRemoteDescription(t),n.ondatachannel=n=>{i.value=n.channel,i.value.onopen=()=>a.value="Готов к передаче!",i.value.onmessage=n=>e(n)};let s=await n.createAnswer();v("answer",JSON.stringify(s)),await n.setLocalDescription(s)};return(0,s.bv)(p),{sendMessage:v,sendId:f,id:t,linkStatus:a,inputValue:l,webrctStatus:r,dataChannel:i}}var X={name:"MainBlock",components:{SendView:R,ReceiveView:H,ConnectionView:Y},data(){return{selectMode:!0}},setup(){const{percentOfSend:e,sendFile:n}=q(),{fileName:t,webrctMessage:a,onMesRTC:s}=G(),{sendId:l,id:i,inputValue:r,linkStatus:o,webrctStatus:c,dataChannel:d}=Q(s);return{sendFile:n,percentOfSend:e,fileName:t,webrctMessage:a,id:i,sendId:l,inputValue:r,linkStatus:o,webrctStatus:c,dataChannel:d}},methods:{},mounted(){}};const ee=(0,D.Z)(X,[["render",_],["__scopeId","data-v-023de63a"]]);var ne=ee,te={name:"MainPage",components:{MainBlock:ne},props:{}};const ae=(0,D.Z)(te,[["render",p],["__scopeId","data-v-6495bc0a"]]);var se=ae,le={name:"App",components:{MainPage:se}};const ie=(0,D.Z)(le,[["render",r]]);var re=ie;(0,a.ri)(re).mount("#app")}},n={};function t(a){var s=n[a];if(void 0!==s)return s.exports;var l=n[a]={exports:{}};return e[a](l,l.exports,t),l.exports}t.m=e,function(){var e=[];t.O=function(n,a,s,l){if(!a){var i=1/0;for(d=0;d<e.length;d++){a=e[d][0],s=e[d][1],l=e[d][2];for(var r=!0,o=0;o<a.length;o++)(!1&l||i>=l)&&Object.keys(t.O).every((function(e){return t.O[e](a[o])}))?a.splice(o--,1):(r=!1,l<i&&(i=l));if(r){e.splice(d--,1);var c=s();void 0!==c&&(n=c)}}return n}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[a,s,l]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};t.O.j=function(n){return 0===e[n]};var n=function(n,a){var s,l,i=a[0],r=a[1],o=a[2],c=0;if(i.some((function(n){return 0!==e[n]}))){for(s in r)t.o(r,s)&&(t.m[s]=r[s]);if(o)var d=o(t)}for(n&&n(a);c<i.length;c++)l=i[c],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(d)},a=self["webpackChunkclient"]=self["webpackChunkclient"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=t.O(void 0,[998],(function(){return t(6525)}));a=t.O(a)})();
//# sourceMappingURL=app.2be0fd64.js.map