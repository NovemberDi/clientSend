(function(){"use strict";var e={3595:function(e,n,t){var a=t(9242),l=t(3396);const i={class:"wrapper__page"},s=(0,l._)("div",{class:"adv"},null,-1);function o(e,n,t,a,o,r){const d=(0,l.up)("main-page");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(d),s])}const r=e=>((0,l.dD)("data-v-b5f8fe00"),e=e(),(0,l.Cn)(),e),d={class:"page"},c=(0,l.uE)('<div class="header" data-v-b5f8fe00><div class="top" data-v-b5f8fe00><div class="name" data-v-b5f8fe00><p data-v-b5f8fe00>Передайфайл</p></div><div class="logo" data-v-b5f8fe00><p data-v-b5f8fe00>Лого</p></div></div><div class="bottom" data-v-b5f8fe00><h2 data-v-b5f8fe00>Сервис удобного обмена файлами</h2></div></div>',1),u=r((()=>(0,l._)("div",{class:"footer"},null,-1)));function v(e,n,t,a,i,s){const o=(0,l.up)("main-block");return(0,l.wg)(),(0,l.iD)("div",d,[c,(0,l.Wm)(o),u])}var f=t(7139);const p=e=>((0,l.dD)("data-v-3a2a7dcb"),e=e(),(0,l.Cn)(),e),w={class:"main"},m={class:"event"},g=p((()=>(0,l._)("div",{class:"shadow_box"},null,-1))),_={class:"main__content"},b={class:"connection__id"};function h(e,n,t,i,s,o){const r=(0,l.up)("send-view"),d=(0,l.up)("receive-view"),c=(0,l.up)("connection-view");return(0,l.wg)(),(0,l.iD)("div",w,[(0,l.wy)((0,l._)("div",m,null,512),[[a.F8,i.downloadEvent]]),(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,f.C_)(["stik stik__one",{active__one:s.selectMode,disactive__one:!s.selectMode}]),onClick:n[0]||(n[0]=e=>s.selectMode=!0)},"Передать",2),(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,f.C_)(["stik stik__two",{active__two:!s.selectMode,disactive__two:s.selectMode}]),onClick:n[1]||(n[1]=e=>{s.selectMode=!1,i.downloadEvent=!1})},"Получить ",2),g,(0,l._)("div",_,[(0,l.wy)((0,l.Wm)(r,{class:(0,f.C_)({mute:!i.dataChannel}),percentOfSend:i.percentOfSend,onOnClickSend:n[2]||(n[2]=e=>i.sendFile(e,this.dataChannel))},null,8,["class","percentOfSend"]),[[a.F8,s.selectMode]]),(0,l.wy)((0,l.Wm)(d,{onClick:n[3]||(n[3]=e=>i.downloadEvent=!1),webrctMessage:i.webrctMessage,fileName:i.fileName,percentOfReceive:i.percentOfReceive},null,8,["webrctMessage","fileName","percentOfReceive"]),[[a.F8,!s.selectMode]])]),(0,l._)("div",b,[(0,l.Wm)(c,{id:i.id,linkStatus:i.linkStatus,onSendId:i.sendId,modelValue:i.inputValue,"onUpdate:modelValue":n[4]||(n[4]=e=>i.inputValue=e)},null,8,["id","linkStatus","onSendId","modelValue"])])])}const y=e=>((0,l.dD)("data-v-097f7f30"),e=e(),(0,l.Cn)(),e),O={class:"send__wrap"},S={class:"send_mess"},C={class:"input-file"},k=y((()=>(0,l._)("span",{class:"input-file-btn"},"Выберите файл",-1))),I={class:"input-file-text",type:"text"},M={class:"send"},V={class:"percent"};function N(e,n,t,a,i,s){return(0,l.wg)(),(0,l.iD)("div",O,[(0,l._)("div",S,[(0,l._)("label",C,[k,(0,l._)("span",I,(0,f.zw)(i.nameFile),1),(0,l._)("input",{class:"input",type:"file",onChange:n[0]||(n[0]=(...e)=>s.onChangeInput&&s.onChangeInput(...e))},null,32)]),(0,l._)("div",M,[(0,l._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>s.sendFile&&s.sendFile(...e))}," Отправить")])]),(0,l._)("div",{class:"progress",style:(0,f.j5)(`background: linear-gradient(90deg, rgb(0, 136, 255) ${t.percentOfSend}%, rgb(215, 215, 215) ${t.percentOfSend}%)`)},null,4),(0,l._)("div",V,(0,f.zw)(t.percentOfSend)+"% ",1)])}var R={name:"SendView",data(){return{inputValue:null,nameFile:null}},props:{percentOfSend:""},methods:{sendFile(){this.inputValue&&this.$emit("onClickSend",this.inputValue)},onChangeInput(e){this.inputValue=e,this.nameFile=this.inputValue?this.inputValue.target.files[0].name:null}}},D=t(89);const F=(0,D.Z)(R,[["render",N],["__scopeId","data-v-097f7f30"]]);var z=F;const H=e=>((0,l.dD)("data-v-30278092"),e=e(),(0,l.Cn)(),e),J={class:"message"},j=H((()=>(0,l._)("div",null,"Ваш файл: ",-1))),$={class:"href"},x=["href","download"],E={class:"percent"};function A(e,n,t,a,i,s){return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",J,[j,(0,l._)("div",$,[(0,l._)("a",{href:`${t.webrctMessage}`,download:`${t.fileName}`},(0,f.zw)(t.fileName),9,x)]),(0,l._)("div",{class:"progress",style:(0,f.j5)(`background: linear-gradient(90deg, rgb(0, 136, 255) ${t.percentOfReceive}%, rgb(215, 215, 215) ${t.percentOfReceive}%)`)},null,4),(0,l._)("div",E,(0,f.zw)(t.percentOfReceive)+"% ",1)])])}var B={name:"ReceiveView",props:{fileName:"",webrctMessage:"",percentOfReceive:""}};const T=(0,D.Z)(B,[["render",A],["__scopeId","data-v-30278092"]]);var W=T;const Z=e=>((0,l.dD)("data-v-398e7d96"),e=e(),(0,l.Cn)(),e),L={class:"id__wrap"},P={class:"id"},U=Z((()=>(0,l._)("div",{class:"qr"},null,-1))),q={class:"send_id"},K=["value"];function G(e,n,t,i,s,o){return(0,l.wg)(),(0,l.iD)("div",L,[(0,l._)("div",P," Мой ID: "+(0,f.zw)(t.id),1),(0,l._)("div",null,[(0,l._)("p",null," Состояние: "+(0,f.zw)(t.linkStatus),1)]),U,(0,l._)("div",q,[(0,l._)("input",{class:"input-id",type:"text",value:t.modelValue,placeholder:"Введите ID партнёра",onInput:n[0]||(n[0]=(...e)=>o.updateInput&&o.updateInput(...e)),onKeyup:n[1]||(n[1]=(0,a.D2)(((...e)=>o.sendId&&o.sendId(...e)),["enter"]))},null,40,K),(0,l._)("button",{class:"send-btn",onClick:n[2]||(n[2]=(...e)=>o.sendId&&o.sendId(...e))}," Вступить")])])}var Q={name:"ConnectionView",props:{id:{type:String},linkStatus:{type:String},modelValue:[String,Number]},methods:{sendId(){this.$emit("sendId")},updateInput(e){this.$emit("update:modelValue",e.target.value)}}};const X=(0,D.Z)(Q,[["render",G],["__scopeId","data-v-398e7d96"]]);var Y=X,ee=t(4870);function ne(){let e=(0,ee.iH)("0"),n=null,t=(t,a)=>{n=t.target.files[0],console.log(n.name,n.size,n.type);let l=n.size,i=262144,s=0,o=new FileReader,r=()=>{let t=n.slice(s,s+i);s+=i,e.value=Math.floor(100*(s/l>1?1:s/l))+"",o.readAsArrayBuffer(t)};o.onload=async()=>{a&&(a.send(o.result),a.bufferedAmount>a.bufferedAmountLowThreshold?a.onbufferedamountlow=()=>{a.onbufferedamountlow=null,s<l?r():(a.send(JSON.stringify({type:"end",name:n.name})),n=null)}:s<l?r():(a.send(JSON.stringify({type:"end",name:n.name})),alert("Отправлено!")))},o.onerror=function(){console.log(o.error)},a.send(JSON.stringify({type:"start",size:n.size})),r()};return{percentOfSend:e,sendFile:t}}function te(){let e=(0,ee.iH)("0"),n=(0,ee.iH)(),t=(0,ee.iH)(),a=(0,ee.iH)(!1),l=0,i=new Blob,s=s=>{if("string"==typeof s.data){let e=JSON.parse(s.data);"start"==e.type?(l=e.size,n.value=null,t.value=null,i=new Blob):(t.value=URL.createObjectURL(i),n.value=e.name,a.value=!0)}else i=i?new Blob([i,s.data]):new Blob([s.data]),e.value=Math.floor(100*(i.size/l>1?1:i.size/l))+""};return{fileName:n,webrctMessage:t,percentOfReceive:e,downloadEvent:a,onMesRTC:s}}function ae(e){let n,t=(0,ee.iH)("ожидание.."),a=(0,ee.iH)("ожидание"),i=(0,ee.iH)(""),s=(0,ee.iH)(),o=(0,ee.iH)(),r=null,d=!1,c="",u="",v=[],f=()=>{r=new WebSocket("wss://peredaifile.ru:3000"),r.onmessage=e=>{let l=JSON.parse(e.data);console.log("сообщение от сервера!"),"iceServers"==l.type&&(v=l.value),"id"==l.type&&(t.value=l.value),"link"==l.type&&(a.value=l.value,d&&_()),"newOffer"==l.type&&(c=l.value,b(l.value)),"newAnswer"==l.type&&(u=l.value,n.setRemoteDescription(JSON.parse(u))),"candidate"==l.type&&(console.log("Новый кандидат",l.value),g(l.value))}},p=(e,n)=>{let t={type:e,value:n};r.send(JSON.stringify(t))},w=()=>{p("id",i.value),i.value=null,d=!0},m=async()=>{n=new RTCPeerConnection({iceServers:v}),n.onerror=e=>{console.log(e)},n.onicecandidate=e=>{const n={type:"candidate",value:null};n.value=e.candidate,p(n.type,n.value)}},g=async e=>{n||await m(),await n.addIceCandidate(e),console.log("Кандидат добавлен")},_=async()=>{await m(),s.value=n.createDataChannel("test"),s.value.onopen=()=>a.value="Готов к передаче!",s.value.onclose=()=>h(),s.value.onmessage=n=>e(n);let t=await n.createOffer();console.log(t),p("offer",JSON.stringify(t)),await n.setLocalDescription(t)},b=async()=>{n||await m();let t=JSON.parse(c);console.log(t),n.setRemoteDescription(t),n.ondatachannel=n=>{s.value=n.channel,s.value.onopen=()=>a.value="Готов к передаче!",s.value.onclose=()=>h(),s.value.onmessage=n=>e(n)};let l=await n.createAnswer();p("answer",JSON.stringify(l)),await n.setLocalDescription(l)};function h(){n=null,s.value=null,c="",u="",d=!1,a.value="ожидание"}return(0,l.bv)(f),{sendMessage:p,sendId:w,id:t,linkStatus:a,inputValue:i,webrctStatus:o,dataChannel:s}}var le={name:"MainBlock",components:{SendView:z,ReceiveView:W,ConnectionView:Y},data(){return{selectMode:!0}},setup(){const{percentOfSend:e,sendFile:n}=ne(),{fileName:t,webrctMessage:a,percentOfReceive:l,downloadEvent:i,onMesRTC:s}=te(),{sendId:o,id:r,inputValue:d,linkStatus:c,webrctStatus:u,dataChannel:v}=ae(s);return{sendFile:n,percentOfSend:e,fileName:t,webrctMessage:a,percentOfReceive:l,downloadEvent:i,id:r,sendId:o,inputValue:d,linkStatus:c,webrctStatus:u,dataChannel:v}},methods:{},mounted(){},watch(){}};const ie=(0,D.Z)(le,[["render",h],["__scopeId","data-v-3a2a7dcb"]]);var se=ie,oe={name:"MainPage",components:{MainBlock:se},props:{}};const re=(0,D.Z)(oe,[["render",v],["__scopeId","data-v-b5f8fe00"]]);var de=re,ce={name:"App",components:{MainPage:de}};const ue=(0,D.Z)(ce,[["render",o]]);var ve=ue;(0,a.ri)(ve).mount("#app")}},n={};function t(a){var l=n[a];if(void 0!==l)return l.exports;var i=n[a]={exports:{}};return e[a](i,i.exports,t),i.exports}t.m=e,function(){var e=[];t.O=function(n,a,l,i){if(!a){var s=1/0;for(c=0;c<e.length;c++){a=e[c][0],l=e[c][1],i=e[c][2];for(var o=!0,r=0;r<a.length;r++)(!1&i||s>=i)&&Object.keys(t.O).every((function(e){return t.O[e](a[r])}))?a.splice(r--,1):(o=!1,i<s&&(s=i));if(o){e.splice(c--,1);var d=l();void 0!==d&&(n=d)}}return n}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[a,l,i]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};t.O.j=function(n){return 0===e[n]};var n=function(n,a){var l,i,s=a[0],o=a[1],r=a[2],d=0;if(s.some((function(n){return 0!==e[n]}))){for(l in o)t.o(o,l)&&(t.m[l]=o[l]);if(r)var c=r(t)}for(n&&n(a);d<s.length;d++)i=s[d],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(c)},a=self["webpackChunkclient"]=self["webpackChunkclient"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=t.O(void 0,[998],(function(){return t(3595)}));a=t.O(a)})();
//# sourceMappingURL=app.bcf53a27.js.map