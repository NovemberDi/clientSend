(function(){"use strict";var e={8757:function(e,n,t){var a=t(9242),l=t(3396);const s={class:"wrapper__page"},i=(0,l._)("div",{class:"adv"},null,-1);function o(e,n,t,a,o,r){const d=(0,l.up)("main-page");return(0,l.wg)(),(0,l.iD)("div",s,[(0,l.Wm)(d),i])}const r=e=>((0,l.dD)("data-v-61b1b9c3"),e=e(),(0,l.Cn)(),e),d={class:"page"},c=(0,l.uE)('<div class="header" data-v-61b1b9c3><div class="top" data-v-61b1b9c3><div class="name" data-v-61b1b9c3><p data-v-61b1b9c3>Передайфайл</p></div><div class="logo" data-v-61b1b9c3><p data-v-61b1b9c3>Лого</p></div></div><div class="bottom" data-v-61b1b9c3><h2 data-v-61b1b9c3>Сервис удобного обмена файлами</h2></div></div>',1),u=r((()=>(0,l._)("div",{class:"footer"},null,-1)));function v(e,n,t,a,s,i){const o=(0,l.up)("main-block");return(0,l.wg)(),(0,l.iD)("div",d,[c,(0,l.Wm)(o),u])}var p=t(7139);const f=e=>((0,l.dD)("data-v-3a2a7dcb"),e=e(),(0,l.Cn)(),e),w={class:"main"},b={class:"event"},m=f((()=>(0,l._)("div",{class:"shadow_box"},null,-1))),g={class:"main__content"},_={class:"connection__id"};function h(e,n,t,s,i,o){const r=(0,l.up)("send-view"),d=(0,l.up)("receive-view"),c=(0,l.up)("connection-view");return(0,l.wg)(),(0,l.iD)("div",w,[(0,l.wy)((0,l._)("div",b,null,512),[[a.F8,s.downloadEvent]]),(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,p.C_)(["stik stik__one",{active__one:i.selectMode,disactive__one:!i.selectMode}]),onClick:n[0]||(n[0]=e=>i.selectMode=!0)},"Передать",2),(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,p.C_)(["stik stik__two",{active__two:!i.selectMode,disactive__two:i.selectMode}]),onClick:n[1]||(n[1]=e=>{i.selectMode=!1,s.downloadEvent=!1})},"Получить ",2),m,(0,l._)("div",g,[(0,l.wy)((0,l.Wm)(r,{class:(0,p.C_)({mute:!s.dataChannel}),percentOfSend:s.percentOfSend,onOnClickSend:n[2]||(n[2]=e=>s.sendFile(e,this.dataChannel))},null,8,["class","percentOfSend"]),[[a.F8,i.selectMode]]),(0,l.wy)((0,l.Wm)(d,{onClick:n[3]||(n[3]=e=>s.downloadEvent=!1),webrctMessage:s.webrctMessage,fileName:s.fileName,percentOfReceive:s.percentOfReceive},null,8,["webrctMessage","fileName","percentOfReceive"]),[[a.F8,!i.selectMode]])]),(0,l._)("div",_,[(0,l.Wm)(c,{id:s.id,linkStatus:s.linkStatus,onSendId:s.sendId,modelValue:s.inputValue,"onUpdate:modelValue":n[4]||(n[4]=e=>s.inputValue=e)},null,8,["id","linkStatus","onSendId","modelValue"])])])}const y=e=>((0,l.dD)("data-v-097f7f30"),e=e(),(0,l.Cn)(),e),O={class:"send__wrap"},S={class:"send_mess"},C={class:"input-file"},k=y((()=>(0,l._)("span",{class:"input-file-btn"},"Выберите файл",-1))),I={class:"input-file-text",type:"text"},M={class:"send"},V={class:"percent"};function N(e,n,t,a,s,i){return(0,l.wg)(),(0,l.iD)("div",O,[(0,l._)("div",S,[(0,l._)("label",C,[k,(0,l._)("span",I,(0,p.zw)(s.nameFile),1),(0,l._)("input",{class:"input",type:"file",onChange:n[0]||(n[0]=(...e)=>i.onChangeInput&&i.onChangeInput(...e))},null,32)]),(0,l._)("div",M,[(0,l._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>i.sendFile&&i.sendFile(...e))}," Отправить")])]),(0,l._)("div",{class:"progress",style:(0,p.j5)(`background: linear-gradient(90deg, rgb(0, 136, 255) ${t.percentOfSend}%, rgb(215, 215, 215) ${t.percentOfSend}%)`)},null,4),(0,l._)("div",V,(0,p.zw)(t.percentOfSend)+"% ",1)])}var R={name:"SendView",data(){return{inputValue:null,nameFile:null}},props:{percentOfSend:""},methods:{sendFile(){this.inputValue&&this.$emit("onClickSend",this.inputValue)},onChangeInput(e){this.inputValue=e,this.nameFile=this.inputValue?this.inputValue.target.files[0].name:null}}},D=t(89);const F=(0,D.Z)(R,[["render",N],["__scopeId","data-v-097f7f30"]]);var z=F;const H=e=>((0,l.dD)("data-v-30278092"),e=e(),(0,l.Cn)(),e),J={class:"message"},j=H((()=>(0,l._)("div",null,"Ваш файл: ",-1))),$={class:"href"},x=["href","download"],E={class:"percent"};function A(e,n,t,a,s,i){return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",J,[j,(0,l._)("div",$,[(0,l._)("a",{href:`${t.webrctMessage}`,download:`${t.fileName}`},(0,p.zw)(t.fileName),9,x)]),(0,l._)("div",{class:"progress",style:(0,p.j5)(`background: linear-gradient(90deg, rgb(0, 136, 255) ${t.percentOfReceive}%, rgb(215, 215, 215) ${t.percentOfReceive}%)`)},null,4),(0,l._)("div",E,(0,p.zw)(t.percentOfReceive)+"% ",1)])])}var B={name:"ReceiveView",props:{fileName:"",webrctMessage:"",percentOfReceive:""}};const T=(0,D.Z)(B,[["render",A],["__scopeId","data-v-30278092"]]);var W=T;const Z=e=>((0,l.dD)("data-v-398e7d96"),e=e(),(0,l.Cn)(),e),L={class:"id__wrap"},P={class:"id"},U=Z((()=>(0,l._)("div",{class:"qr"},null,-1))),q={class:"send_id"},K=["value"];function G(e,n,t,s,i,o){return(0,l.wg)(),(0,l.iD)("div",L,[(0,l._)("div",P," Мой ID: "+(0,p.zw)(t.id),1),(0,l._)("div",null,[(0,l._)("p",null," Состояние: "+(0,p.zw)(t.linkStatus),1)]),U,(0,l._)("div",q,[(0,l._)("input",{class:"input-id",type:"text",value:t.modelValue,placeholder:"Введите ID партнёра",onInput:n[0]||(n[0]=(...e)=>o.updateInput&&o.updateInput(...e)),onKeyup:n[1]||(n[1]=(0,a.D2)(((...e)=>o.sendId&&o.sendId(...e)),["enter"]))},null,40,K),(0,l._)("button",{class:"send-btn",onClick:n[2]||(n[2]=(...e)=>o.sendId&&o.sendId(...e))}," Вступить")])])}var Q={name:"ConnectionView",props:{id:{type:String},linkStatus:{type:String},modelValue:[String,Number]},methods:{sendId(){this.$emit("sendId")},updateInput(e){this.$emit("update:modelValue",e.target.value)}}};const X=(0,D.Z)(Q,[["render",G],["__scopeId","data-v-398e7d96"]]);var Y=X,ee=t(4870);function ne(){let e=(0,ee.iH)("0"),n=null,t=(t,a)=>{n=t.target.files[0],console.log(n.name,n.size,n.type);let l=n.size,s=262144,i=0,o=new FileReader,r=()=>{let t=n.slice(i,i+s);i+=s,e.value=Math.floor(100*(i/l>1?1:i/l))+"",o.readAsArrayBuffer(t)};o.onload=async()=>{a&&(a.send(o.result),a.bufferedAmount>a.bufferedAmountLowThreshold?a.onbufferedamountlow=()=>{a.onbufferedamountlow=null,i<l?r():(a.send(JSON.stringify({type:"end",name:n.name})),n=null)}:i<l?r():(a.send(JSON.stringify({type:"end",name:n.name})),alert("Отправлено!")))},o.onerror=function(){console.log(o.error)},a.send(JSON.stringify({type:"start",size:n.size})),r()};return{percentOfSend:e,sendFile:t}}function te(){let e=(0,ee.iH)("0"),n=(0,ee.iH)(),t=(0,ee.iH)(),a=(0,ee.iH)(!1),l=0,s=new Blob,i=i=>{if("string"==typeof i.data){let e=JSON.parse(i.data);"start"==e.type?(l=e.size,n.value=null,t.value=null,s=new Blob):(t.value=URL.createObjectURL(s),n.value=e.name,a.value=!0)}else s=s?new Blob([s,i.data]):new Blob([i.data]),e.value=Math.floor(100*(s.size/l>1?1:s.size/l))+""};return{fileName:n,webrctMessage:t,percentOfReceive:e,downloadEvent:a,onMesRTC:i}}function ae(e){let n,t=(0,ee.iH)("ожидание.."),a=(0,ee.iH)("ожидание"),s=(0,ee.iH)(""),i=(0,ee.iH)(),o=(0,ee.iH)(),r=null,d=!1,c="",u="",v=[],p=()=>{r=new WebSocket("wss://peredaifile.ru:3000"),r.onmessage=e=>{let l=JSON.parse(e.data);console.log("сообщение от сервера!"),"iceServers"==l.type&&(v=l.value,console.log(v)),"id"==l.type&&(t.value=l.value),"link"==l.type&&(a.value=l.value,d&&g()),"newOffer"==l.type&&(c=l.value,_(l.value)),"newAnswer"==l.type&&(u=l.value,n.setRemoteDescription(JSON.parse(u))),"candidate"==l.type&&(console.log("Новый кандидат",l.value),m(l.value))}},f=(e,n)=>{let t={type:e,value:n};r.send(JSON.stringify(t))},w=()=>{f("id",s.value),s.value=null,d=!0},b=async()=>{n=new RTCPeerConnection({iceServers:v}),n.onerror=e=>{console.log(e)},n.onicecandidate=e=>{const n={type:"candidate",value:null};n.value=e.candidate,f(n.type,n.value)}},m=async e=>{n||await b(),await n.addIceCandidate(e),console.log("Кандидат добавлен")},g=async()=>{await b(),i.value=n.createDataChannel("test"),i.value.onopen=()=>a.value="Готов к передаче!",i.value.onclose=()=>h(),i.value.onmessage=n=>e(n);let t=await n.createOffer();console.log(t),f("offer",JSON.stringify(t)),await n.setLocalDescription(t)},_=async()=>{n||await b();let t=JSON.parse(c);console.log(t),n.setRemoteDescription(t),n.ondatachannel=n=>{i.value=n.channel,i.value.onopen=()=>a.value="Готов к передаче!",i.value.onclose=()=>h(),i.value.onmessage=n=>e(n)};let l=await n.createAnswer();f("answer",JSON.stringify(l)),await n.setLocalDescription(l)};function h(){n=null,i.value=null,c="",u="",d=!1,a.value="ожидание"}return(0,l.bv)(p),{sendMessage:f,sendId:w,id:t,linkStatus:a,inputValue:s,webrctStatus:o,dataChannel:i}}var le={name:"MainBlock",components:{SendView:z,ReceiveView:W,ConnectionView:Y},data(){return{selectMode:!0}},setup(){const{percentOfSend:e,sendFile:n}=ne(),{fileName:t,webrctMessage:a,percentOfReceive:l,downloadEvent:s,onMesRTC:i}=te(),{sendId:o,id:r,inputValue:d,linkStatus:c,webrctStatus:u,dataChannel:v}=ae(i);return{sendFile:n,percentOfSend:e,fileName:t,webrctMessage:a,percentOfReceive:l,downloadEvent:s,id:r,sendId:o,inputValue:d,linkStatus:c,webrctStatus:u,dataChannel:v}},methods:{},mounted(){},watch(){}};const se=(0,D.Z)(le,[["render",h],["__scopeId","data-v-3a2a7dcb"]]);var ie=se,oe={name:"MainPage",components:{MainBlock:ie},props:{}};const re=(0,D.Z)(oe,[["render",v],["__scopeId","data-v-61b1b9c3"]]);var de=re,ce={name:"App",components:{MainPage:de}};const ue=(0,D.Z)(ce,[["render",o]]);var ve=ue;(0,a.ri)(ve).mount("#app")}},n={};function t(a){var l=n[a];if(void 0!==l)return l.exports;var s=n[a]={exports:{}};return e[a](s,s.exports,t),s.exports}t.m=e,function(){var e=[];t.O=function(n,a,l,s){if(!a){var i=1/0;for(c=0;c<e.length;c++){a=e[c][0],l=e[c][1],s=e[c][2];for(var o=!0,r=0;r<a.length;r++)(!1&s||i>=s)&&Object.keys(t.O).every((function(e){return t.O[e](a[r])}))?a.splice(r--,1):(o=!1,s<i&&(i=s));if(o){e.splice(c--,1);var d=l();void 0!==d&&(n=d)}}return n}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[a,l,s]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};t.O.j=function(n){return 0===e[n]};var n=function(n,a){var l,s,i=a[0],o=a[1],r=a[2],d=0;if(i.some((function(n){return 0!==e[n]}))){for(l in o)t.o(o,l)&&(t.m[l]=o[l]);if(r)var c=r(t)}for(n&&n(a);d<i.length;d++)s=i[d],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(c)},a=self["webpackChunkclient"]=self["webpackChunkclient"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=t.O(void 0,[998],(function(){return t(8757)}));a=t.O(a)})();
//# sourceMappingURL=app.34b5d60e.js.map