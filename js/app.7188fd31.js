(function(){"use strict";var e={6346:function(e,n,a){var t=a(9242),l=a(3396);const s={class:"wrapper__page"},i=(0,l._)("div",{class:"adv"},null,-1);function o(e,n,a,t,o,r){const c=(0,l.up)("main-page");return(0,l.wg)(),(0,l.iD)("div",s,[(0,l.Wm)(c),i])}const r=e=>((0,l.dD)("data-v-a1c6a4c8"),e=e(),(0,l.Cn)(),e),c={class:"page"},d=(0,l.uE)('<div class="header" data-v-a1c6a4c8><div class="top" data-v-a1c6a4c8><div class="name" data-v-a1c6a4c8><p data-v-a1c6a4c8>Передайфайл</p></div><div class="logo" data-v-a1c6a4c8><p data-v-a1c6a4c8>Лого</p></div></div><div class="bottom" data-v-a1c6a4c8><h2 data-v-a1c6a4c8>Сервис удобного обмена файлами</h2></div></div>',1),u=r((()=>(0,l._)("div",{class:"footer"},null,-1)));function p(e,n,a,t,s,i){const o=(0,l.up)("main-block");return(0,l.wg)(),(0,l.iD)("div",c,[d,(0,l.Wm)(o),u])}var v=a(7139);const f=e=>((0,l.dD)("data-v-71b6e2ff"),e=e(),(0,l.Cn)(),e),m={class:"main"},w=f((()=>(0,l._)("div",{class:"shadow_box"},null,-1))),_={class:"main__content"},g={class:"connection__id"};function b(e,n,a,s,i,o){const r=(0,l.up)("send-view"),c=(0,l.up)("receive-view"),d=(0,l.up)("connection-view");return(0,l.wg)(),(0,l.iD)("div",m,[(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,v.C_)(["stik stik__one",{active__one:i.selectMode,disactive__one:!i.selectMode}]),onClick:n[0]||(n[0]=e=>i.selectMode=!i.selectMode)},"Передать",2),(0,l._)("div",{onselectstart:"return false",onmousedown:"return false",class:(0,v.C_)(["stik stik__two",{active__two:!i.selectMode,disactive__two:i.selectMode}]),onClick:n[1]||(n[1]=e=>i.selectMode=!i.selectMode)},"Получить",2),w,(0,l._)("div",_,[(0,l.wy)((0,l.Wm)(r,{class:(0,v.C_)({mute:!s.dataChannel}),percentOfSend:s.percentOfSend,onOnClickSend:n[2]||(n[2]=e=>s.sendFile(e,this.dataChannel))},null,8,["class","percentOfSend"]),[[t.F8,i.selectMode]]),(0,l.wy)((0,l.Wm)(c,{webrctMessage:s.webrctMessage,fileName:s.fileName},null,8,["webrctMessage","fileName"]),[[t.F8,!i.selectMode]])]),(0,l._)("div",g,[(0,l.Wm)(d,{id:s.id,linkStatus:s.linkStatus,onSendId:s.sendId,modelValue:s.inputValue,"onUpdate:modelValue":n[3]||(n[3]=e=>s.inputValue=e)},null,8,["id","linkStatus","onSendId","modelValue"])])])}const h=e=>((0,l.dD)("data-v-097f7f30"),e=e(),(0,l.Cn)(),e),y={class:"send__wrap"},S={class:"send_mess"},M={class:"input-file"},O=h((()=>(0,l._)("span",{class:"input-file-btn"},"Выберите файл",-1))),C={class:"input-file-text",type:"text"},k={class:"send"},I={class:"percent"};function V(e,n,a,t,s,i){return(0,l.wg)(),(0,l.iD)("div",y,[(0,l._)("div",S,[(0,l._)("label",M,[O,(0,l._)("span",C,(0,v.zw)(s.nameFile),1),(0,l._)("input",{class:"input",type:"file",onChange:n[0]||(n[0]=(...e)=>i.onChangeInput&&i.onChangeInput(...e))},null,32)]),(0,l._)("div",k,[(0,l._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>i.sendFile&&i.sendFile(...e))}," Отправить")])]),(0,l._)("div",{class:"progress",style:(0,v.j5)(`background: linear-gradient(90deg, rgb(0, 136, 255) ${a.percentOfSend}%, rgb(215, 215, 215) ${a.percentOfSend}%)`)},null,4),(0,l._)("div",I,(0,v.zw)(a.percentOfSend)+"% ",1)])}var D={name:"SendView",data(){return{inputValue:null,nameFile:null}},props:{percentOfSend:""},methods:{sendFile(){this.inputValue&&this.$emit("onClickSend",this.inputValue)},onChangeInput(e){this.inputValue=e,this.nameFile=this.inputValue?this.inputValue.target.files[0].name:null}}},N=a(89);const F=(0,N.Z)(D,[["render",V],["__scopeId","data-v-097f7f30"]]);var R=F;const T=e=>((0,l.dD)("data-v-64c8858a"),e=e(),(0,l.Cn)(),e),x={class:"message"},J=T((()=>(0,l._)("div",null,"Ваш файл: ",-1))),j={class:"href"},H=["href","download"];function z(e,n,a,t,s,i){return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",x,[J,(0,l._)("div",j,[(0,l._)("a",{href:`${a.webrctMessage}`,download:`${a.fileName}`},(0,v.zw)(a.fileName),9,H)])])])}var A={name:"ReceiveView",props:{fileName:"",webrctMessage:""}};const B=(0,N.Z)(A,[["render",z],["__scopeId","data-v-64c8858a"]]);var $=B;const W=e=>((0,l.dD)("data-v-58f7c633"),e=e(),(0,l.Cn)(),e),Z={class:"id__wrap"},L={class:"id"},P=W((()=>(0,l._)("div",{class:"qr"},null,-1))),K={class:"send_id"},U=["value"];function Y(e,n,a,t,s,i){return(0,l.wg)(),(0,l.iD)("div",Z,[(0,l._)("div",L," Мой ID: "+(0,v.zw)(a.id),1),(0,l._)("div",null,[(0,l._)("p",null," Состояние: "+(0,v.zw)(a.linkStatus),1)]),P,(0,l._)("div",K,[(0,l._)("input",{class:"input-id",type:"text",value:a.modelValue,placeholder:"Введите ID партнёра",onInput:n[0]||(n[0]=(...e)=>i.updateInput&&i.updateInput(...e))},null,40,U),(0,l._)("button",{class:"send-btn",onClick:n[1]||(n[1]=(...e)=>i.sendId&&i.sendId(...e))}," Вступить")])])}var E={name:"ConnectionView",props:{id:{type:String},linkStatus:{type:String},modelValue:[String,Number]},methods:{sendId(){this.$emit("sendId")},updateInput(e){this.$emit("update:modelValue",e.target.value)}}};const q=(0,N.Z)(E,[["render",Y],["__scopeId","data-v-58f7c633"]]);var G=q,Q=a(4870);function X(){let e=(0,Q.iH)("0"),n=null,a=(a,t)=>{n=a.target.files[0],console.log(n.name,n.size,n.type);let l=n.size,s=262144,i=0,o=new FileReader,r=()=>{let a=n.slice(i,i+s);i+=s,e.value=Math.floor(100*(i/l>1?1:i/l))+"",o.readAsArrayBuffer(a)};o.onload=()=>{t&&(t.send(o.result),t.bufferedAmount>t.bufferedAmountLowThreshold?t.onbufferedamountlow=()=>{t.onbufferedamountlow=null,i<l?r():(t.send(JSON.stringify({type:"end",name:n.name})),n=null)}:i<l?r():(t.send(JSON.stringify({type:"end",name:n.name})),alert("Отправлено!")))},o.onerror=function(){console.log(o.error)},r()};return{percentOfSend:e,sendFile:a}}function ee(){let e=new Blob,n=(0,Q.iH)(),a=(0,Q.iH)(),t=(window.indexedDB.open("MyTestDatabase",1),t=>{"string"==typeof t.data?(a.value=URL.createObjectURL(e),n.value=JSON.parse(t.data).name):e=e?new Blob([e,t.data]):new Blob([t.data])});return{fileName:n,webrctMessage:a,onMesRTC:t}}function ne(e){let n,a=(0,Q.iH)("ожидание.."),t=(0,Q.iH)("ожидание"),s=(0,Q.iH)(""),i=(0,Q.iH)(),o=(0,Q.iH)(),r=null,c=!1,d="",u="",p=()=>{r=new WebSocket("wss://wsserver.dimkayaa.repl.co"),r.onmessage=e=>{let l=JSON.parse(e.data);console.log("сообщение от сервера!"),"id"==l.type&&(a.value=l.value),"link"==l.type&&(t.value=l.value,c&&_()),"newOffer"==l.type&&(d=l.value,g(l.value)),"newAnswer"==l.type&&(u=l.value,n.setRemoteDescription(JSON.parse(u))),"candidate"==l.type&&(console.log("Новый кандидат",l.value),w(l.value))}},v=(e,n)=>{let a={type:e,value:n};r.send(JSON.stringify(a))},f=()=>{v("id",s.value),s.value=null,c=!0},m=async()=>{n=new RTCPeerConnection({iceServers:[{urls:"stun:relay.metered.ca:80"},{urls:"turn:relay.metered.ca:80",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"},{urls:"turn:relay.metered.ca:443",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"},{urls:"turn:relay.metered.ca:443?transport=tcp",username:"5253a2d860bc9520ee01c9bd",credential:"1Ky2rMcecoRMIYbT"}]}),n.onicecandidate=e=>{const n={type:"candidate",value:null};n.value=e.candidate,v(n.type,n.value)}},w=async e=>{n||await m(),await n.addIceCandidate(e),console.log("Кандидат добавлен")},_=async()=>{await m(),i.value=n.createDataChannel("test"),i.value.onopen=()=>t.value="Готов к передаче!",i.value.onclose=()=>b(),i.value.onmessage=n=>e(n);let a=await n.createOffer();console.log(a),v("offer",JSON.stringify(a)),await n.setLocalDescription(a)},g=async()=>{n||await m();let a=JSON.parse(d);console.log(a),n.setRemoteDescription(a),n.ondatachannel=n=>{i.value=n.channel,i.value.onopen=()=>t.value="Готов к передаче!",i.value.onclose=()=>b(),i.value.onmessage=n=>e(n)};let l=await n.createAnswer();v("answer",JSON.stringify(l)),await n.setLocalDescription(l)};function b(){n=null,i.value=null,d="",u="",c=!1,t.value="ожидание"}return(0,l.bv)(p),{sendMessage:v,sendId:f,id:a,linkStatus:t,inputValue:s,webrctStatus:o,dataChannel:i}}var ae={name:"MainBlock",components:{SendView:R,ReceiveView:$,ConnectionView:G},data(){return{selectMode:!0}},setup(){const{percentOfSend:e,sendFile:n}=X(),{fileName:a,webrctMessage:t,onMesRTC:l}=ee(),{sendId:s,id:i,inputValue:o,linkStatus:r,webrctStatus:c,dataChannel:d}=ne(l);return{sendFile:n,percentOfSend:e,fileName:a,webrctMessage:t,id:i,sendId:s,inputValue:o,linkStatus:r,webrctStatus:c,dataChannel:d}},methods:{},mounted(){}};const te=(0,N.Z)(ae,[["render",b],["__scopeId","data-v-71b6e2ff"]]);var le=te,se={name:"MainPage",components:{MainBlock:le},props:{}};const ie=(0,N.Z)(se,[["render",p],["__scopeId","data-v-a1c6a4c8"]]);var oe=ie,re={name:"App",components:{MainPage:oe}};const ce=(0,N.Z)(re,[["render",o]]);var de=ce;(0,t.ri)(de).mount("#app")}},n={};function a(t){var l=n[t];if(void 0!==l)return l.exports;var s=n[t]={exports:{}};return e[t](s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(n,t,l,s){if(!t){var i=1/0;for(d=0;d<e.length;d++){t=e[d][0],l=e[d][1],s=e[d][2];for(var o=!0,r=0;r<t.length;r++)(!1&s||i>=s)&&Object.keys(a.O).every((function(e){return a.O[e](t[r])}))?t.splice(r--,1):(o=!1,s<i&&(i=s));if(o){e.splice(d--,1);var c=l();void 0!==c&&(n=c)}}return n}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[t,l,s]}}(),function(){a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,{a:n}),n}}(),function(){a.d=function(e,n){for(var t in n)a.o(n,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};a.O.j=function(n){return 0===e[n]};var n=function(n,t){var l,s,i=t[0],o=t[1],r=t[2],c=0;if(i.some((function(n){return 0!==e[n]}))){for(l in o)a.o(o,l)&&(a.m[l]=o[l]);if(r)var d=r(a)}for(n&&n(t);c<i.length;c++)s=i[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},t=self["webpackChunkclient"]=self["webpackChunkclient"]||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))}();var t=a.O(void 0,[998],(function(){return a(6346)}));t=a.O(t)})();
//# sourceMappingURL=app.7188fd31.js.map
